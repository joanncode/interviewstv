<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Search - Interviews.tv</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom Dark Theme CSS -->
    <style>
        :root {
            --primary-color: #FF0000;
            --bg-dark: #1a1a1a;
            --card-dark: #2a2a2a;
            --input-dark: #3a3a3a;
            --text-light: #ffffff;
            --text-muted: #cccccc;
            --border-color: #444444;
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-light);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
        }

        .navbar {
            background-color: var(--card-dark) !important;
            border-bottom: 2px solid var(--primary-color);
            flex-shrink: 0;
        }

        .navbar-brand {
            color: var(--primary-color) !important;
            font-weight: bold;
            font-size: 1.5rem;
        }

        .navbar-nav .nav-link {
            color: var(--text-light) !important;
        }

        .navbar-nav .nav-link:hover {
            color: var(--primary-color) !important;
        }

        .main-container {
            display: flex;
            height: calc(100vh - 76px);
        }

        .demo-sidebar {
            width: 350px;
            background: var(--card-dark);
            border-right: 1px solid var(--border-color);
            padding: 1.5rem;
            overflow-y: auto;
            flex-shrink: 0;
        }

        .demo-section {
            margin-bottom: 2rem;
        }

        .demo-section h5 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .demo-controls {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .status-indicator.connected {
            background-color: rgba(40, 167, 69, 0.2);
            color: #28a745;
            border: 1px solid #28a745;
        }

        .status-indicator.disconnected {
            background-color: rgba(220, 53, 69, 0.2);
            color: #dc3545;
            border: 1px solid #dc3545;
        }

        .demo-control {
            background: var(--input-dark);
            border: 1px solid var(--border-color);
            color: var(--text-light);
            border-radius: 6px;
            padding: 0.5rem 0.75rem;
            font-size: 0.9rem;
        }

        .demo-control:focus {
            outline: none;
            border-color: var(--primary-color);
            color: var(--text-light);
        }

        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .btn-primary:hover {
            background-color: #cc0000;
            border-color: #cc0000;
        }

        .btn-secondary {
            background-color: var(--input-dark);
            border-color: var(--border-color);
            color: var(--text-light);
        }

        .btn-secondary:hover {
            background-color: #4a4a4a;
            border-color: #555;
            color: var(--text-light);
        }

        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
            position: relative;
        }

        .demo-info {
            background: rgba(23, 162, 184, 0.1);
            border: 1px solid #17a2b8;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .demo-info h6 {
            color: #17a2b8;
            margin-bottom: 0.5rem;
        }

        .demo-info p {
            color: var(--text-muted);
            margin-bottom: 0;
            font-size: 0.9rem;
        }

        .feature-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .feature-list li {
            padding: 0.25rem 0;
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .feature-list li i {
            color: var(--primary-color);
            width: 16px;
            margin-right: 0.5rem;
        }

        .search-demo-controls {
            background: var(--input-dark);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .search-demo-controls h6 {
            color: var(--text-light);
            margin-bottom: 0.75rem;
        }

        .simulation-btn {
            background: var(--card-dark);
            border: 1px solid var(--border-color);
            color: var(--text-light);
            padding: 0.4rem 0.8rem;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
            margin: 0.25rem;
        }

        .simulation-btn:hover {
            background: var(--primary-color);
            border-color: var(--primary-color);
        }

        .simulation-btn.text { border-color: #17a2b8; }
        .simulation-btn.user { border-color: #28a745; }
        .simulation-btn.date { border-color: #ffc107; }
        .simulation-btn.regex { border-color: #6f42c1; }
        .simulation-btn.fuzzy { border-color: #fd7e14; }

        .search-stats {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid var(--primary-color);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .search-stats h6 {
            color: var(--primary-color);
            margin-bottom: 0.75rem;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.25rem 0;
            font-size: 0.9rem;
        }

        .stat-label {
            color: var(--text-muted);
        }

        .stat-value {
            font-weight: 600;
            color: var(--text-light);
        }

        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }
            
            .demo-sidebar {
                width: 100%;
                height: auto;
                max-height: 300px;
                padding: 1rem;
            }
            
            .demo-controls {
                flex-direction: row;
                flex-wrap: wrap;
            }
        }

        /* Highlight animation for search results */
        .highlighted {
            background: rgba(255, 0, 0, 0.2) !important;
            border: 1px solid var(--primary-color) !important;
            animation: highlight-pulse 2s ease-in-out;
        }

        @keyframes highlight-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Search button state */
        .has-results {
            background: var(--primary-color) !important;
            color: white !important;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-video me-2"></i>Interviews.tv
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="interview-room.html">
                            <i class="fas fa-comments me-1"></i>Basic Chat
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="chat-moderation-demo.html">
                            <i class="fas fa-shield-alt me-1"></i>Moderation
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="private-messaging-demo.html">
                            <i class="fas fa-envelope me-1"></i>Private Messages
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="chat-export-demo.html">
                            <i class="fas fa-download me-1"></i>Export
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="modern-chat-demo.html">
                            <i class="fas fa-sparkles me-1"></i>Modern Chat
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="message-threading-demo.html">
                            <i class="fas fa-comments me-1"></i>Threading
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="typing-indicators-demo.html">
                            <i class="fas fa-keyboard me-1"></i>Typing
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="user-list-demo.html">
                            <i class="fas fa-users me-1"></i>User List
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="chat-notifications-demo.html">
                            <i class="fas fa-bell me-1"></i>Notifications
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="chat-search-demo.html">
                            <i class="fas fa-search me-1"></i>Search
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="main-container">
        <!-- Demo Sidebar -->
        <div class="demo-sidebar">
            <!-- Connection Status -->
            <div class="demo-section">
                <h5><i class="fas fa-wifi me-2"></i>Connection</h5>
                <div class="demo-controls">
                    <div class="status-indicator disconnected" id="connection-status">
                        <i class="fas fa-circle"></i>
                        <span>Disconnected</span>
                    </div>
                    <button class="btn btn-primary" id="connect-btn">
                        <i class="fas fa-plug me-2"></i>Connect
                    </button>
                </div>
            </div>

            <!-- User Settings -->
            <div class="demo-section">
                <h5><i class="fas fa-user me-2"></i>User Settings</h5>
                <div class="demo-controls">
                    <select class="demo-control" id="user-role">
                        <option value="participant">Participant</option>
                        <option value="host">Host</option>
                        <option value="moderator">Moderator</option>
                        <option value="admin" selected>Admin</option>
                    </select>
                    <input type="text" class="demo-control" id="user-name" placeholder="Your name" value="Demo User">
                    <input type="text" class="demo-control" id="room-id" placeholder="Room ID" value="demo_room">
                </div>
            </div>

            <!-- Search Features -->
            <div class="demo-section">
                <h5><i class="fas fa-search me-2"></i>Search Features</h5>
                <ul class="feature-list">
                    <li><i class="fas fa-check"></i>Text search with highlighting</li>
                    <li><i class="fas fa-check"></i>Regular expression support</li>
                    <li><i class="fas fa-check"></i>Fuzzy search</li>
                    <li><i class="fas fa-check"></i>Case sensitive options</li>
                    <li><i class="fas fa-check"></i>Whole word matching</li>
                    <li><i class="fas fa-check"></i>User filtering</li>
                    <li><i class="fas fa-check"></i>Role-based filtering</li>
                    <li><i class="fas fa-check"></i>Date range filtering</li>
                    <li><i class="fas fa-check"></i>Message type filtering</li>
                    <li><i class="fas fa-check"></i>Search history</li>
                    <li><i class="fas fa-check"></i>Keyboard shortcuts</li>
                    <li><i class="fas fa-check"></i>Result navigation</li>
                </ul>
            </div>

            <!-- Search Statistics -->
            <div class="search-stats">
                <h6><i class="fas fa-chart-bar me-2"></i>Search Statistics</h6>
                <div class="stat-item">
                    <span class="stat-label">Total Messages:</span>
                    <span class="stat-value" id="total-messages">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Indexed Words:</span>
                    <span class="stat-value" id="indexed-words">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Search History:</span>
                    <span class="stat-value" id="search-history-count">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Current Results:</span>
                    <span class="stat-value" id="current-results">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Search Active:</span>
                    <span class="stat-value" id="search-active">No</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Current Query:</span>
                    <span class="stat-value" id="current-query">None</span>
                </div>
            </div>

            <!-- Search Demo Controls -->
            <div class="search-demo-controls">
                <h6><i class="fas fa-robot me-2"></i>Search Testing</h6>
                <button class="simulation-btn text" onclick="testSearch('hello')">
                    <i class="fas fa-comment me-1"></i>Search "hello"
                </button>
                <button class="simulation-btn text" onclick="testSearch('interview')">
                    <i class="fas fa-briefcase me-1"></i>Search "interview"
                </button>
                <button class="simulation-btn user" onclick="testSearch('user:Alice')">
                    <i class="fas fa-user me-1"></i>Search by User
                </button>
                <button class="simulation-btn regex" onclick="testRegexSearch()">
                    <i class="fas fa-code me-1"></i>Regex Search
                </button>
                <button class="simulation-btn fuzzy" onclick="testFuzzySearch()">
                    <i class="fas fa-magic me-1"></i>Fuzzy Search
                </button>
                
                <div style="margin-top: 0.75rem;">
                    <button class="simulation-btn" onclick="addSampleMessages()">
                        <i class="fas fa-plus me-1"></i>Add Sample Messages
                    </button>
                    <button class="simulation-btn" onclick="clearSearch()">
                        <i class="fas fa-eraser me-1"></i>Clear Search
                    </button>
                    <button class="simulation-btn" onclick="openSearchInterface()">
                        <i class="fas fa-search me-1"></i>Open Search
                    </button>
                    <button class="simulation-btn" onclick="updateSearchStats()">
                        <i class="fas fa-sync me-1"></i>Update Stats
                    </button>
                </div>
            </div>
        </div>

        <!-- Chat Container -->
        <div class="chat-container">
            <!-- Demo Info -->
            <div class="demo-info">
                <h6><i class="fas fa-info-circle me-2"></i>Chat Search Functionality</h6>
                <p>Experience comprehensive search capabilities with text search, regular expressions, fuzzy matching, advanced filtering, and result navigation. Use Ctrl+F to open search, test different search types, and explore the powerful search options panel.</p>
            </div>

            <!-- Chat Interface -->
            <div id="modern-chat-container" style="flex: 1;"></div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Chat Components -->
    <script src="../src/components/EmojiInterface.js"></script>
    <script src="../src/components/ChatModerationInterface.js"></script>
    <script src="../src/components/ChatCommandInterface.js"></script>
    <script src="../src/components/PrivateMessageInterface.js"></script>
    <script src="../src/components/ChatExportInterface.js"></script>
    <script src="../src/components/MessageThreadingInterface.js"></script>
    <script src="../src/components/TypingIndicatorInterface.js"></script>
    <script src="../src/components/UserListInterface.js"></script>
    <script src="../src/components/ChatNotificationInterface.js"></script>
    <script src="../src/components/ChatSearchInterface.js"></script>
    <script src="../src/components/ModernChatInterface.js"></script>
    
    <!-- Demo Script -->
    <script>
        let websocket = null;
        let modernChatInterface = null;
        let searchInterface = null;
        let currentUserRole = 'admin';
        let currentUserName = 'Demo User';
        let currentRoomId = 'demo_room';
        
        // Mock data for simulation
        const mockUserNames = [
            'Alice Johnson', 'Bob Smith', 'Carol Davis', 'David Wilson', 'Emma Brown',
            'Frank Miller', 'Grace Lee', 'Henry Taylor', 'Ivy Chen', 'Jack Anderson'
        ];
        
        const sampleMessages = [
            "Welcome to the interview! Let's start with introductions.",
            "Hi everyone! I'm excited to be here today.",
            "Could you tell us about your background in software development?",
            "I have 5 years of experience working with JavaScript and React.",
            "That's impressive! What's your favorite project you've worked on?",
            "I built a real-time chat application with WebSocket support.",
            "Great question! I think that's a solid foundation.",
            "Thanks for the feedback, it's very helpful.",
            "Let's move on to the next topic about algorithms.",
            "Can you explain how you would implement a binary search?",
            "Binary search is a divide and conquer algorithm.",
            "It works by repeatedly dividing the search interval in half.",
            "The time complexity is O(log n) which is very efficient.",
            "Excellent explanation! Now let's discuss data structures.",
            "What's the difference between arrays and linked lists?",
            "Arrays provide constant time access but fixed size.",
            "Linked lists are dynamic but require sequential access.",
            "Both have their use cases depending on the requirements.",
            "That's a comprehensive answer. Any questions for us?",
            "What technologies does your team use for development?",
            "We primarily use React, Node.js, and PostgreSQL.",
            "We also use Docker for containerization and AWS for hosting.",
            "That sounds like a modern and scalable tech stack.",
            "Thank you for your time today. We'll be in touch soon!",
            "It was great meeting everyone. Looking forward to hearing back!"
        ];
        
        // Initialize demo
        document.addEventListener('DOMContentLoaded', function() {
            initializeDemo();
            attachEventListeners();
        });
        
        function initializeDemo() {
            // Initialize modern chat interface with search
            const container = document.getElementById('modern-chat-container');
            
            if (typeof ModernChatInterface !== 'undefined') {
                modernChatInterface = new ModernChatInterface({
                    container: container,
                    websocket: websocket,
                    currentUserId: 'demo_user',
                    currentUserRole: currentUserRole,
                    roomId: currentRoomId,
                    settings: {
                        theme: 'dark',
                        fontSize: 'medium',
                        soundEnabled: true,
                        notificationsEnabled: true,
                        showTimestamps: true,
                        showAvatars: true,
                        compactMode: false,
                        autoScroll: true
                    }
                });
                
                // Set global reference
                window.modernChat = modernChatInterface;
                
                // Get search interface reference
                searchInterface = modernChatInterface.searchInterface;
                window.chatSearch = searchInterface;
                
                // Update stats initially
                setTimeout(() => {
                    updateSearchStats();
                }, 1000);
            }
        }
        
        function attachEventListeners() {
            // Connect button
            document.getElementById('connect-btn')?.addEventListener('click', toggleConnection);
            
            // User settings
            document.getElementById('user-role')?.addEventListener('change', (e) => {
                currentUserRole = e.target.value;
                if (modernChatInterface) {
                    modernChatInterface.setUserInfo('demo_user', currentUserRole);
                }
            });
            
            document.getElementById('user-name')?.addEventListener('change', (e) => {
                currentUserName = e.target.value;
            });
            
            document.getElementById('room-id')?.addEventListener('change', (e) => {
                currentRoomId = e.target.value;
                if (modernChatInterface) {
                    modernChatInterface.setRoomId(currentRoomId);
                }
            });
        }
        
        function toggleConnection() {
            if (websocket && websocket.readyState === WebSocket.OPEN) {
                disconnectWebSocket();
            } else {
                connectWebSocket();
            }
        }
        
        function connectWebSocket() {
            try {
                // Simulate WebSocket connection
                websocket = {
                    readyState: WebSocket.OPEN,
                    send: function(data) {
                        console.log('Sending:', JSON.parse(data));
                        // Simulate server responses
                        setTimeout(() => {
                            const message = JSON.parse(data);
                            handleMockResponse(message);
                        }, 100);
                    },
                    addEventListener: function(event, handler) {
                        this[event] = handler;
                    },
                    close: function() {
                        this.readyState = WebSocket.CLOSED;
                        if (this.onclose) this.onclose();
                    }
                };
                
                console.log('Mock WebSocket connected');
                updateConnectionStatus(true);
                
                // Update chat interface
                if (modernChatInterface) {
                    modernChatInterface.setWebSocket(websocket);
                }
                
                // Add some initial messages
                setTimeout(() => {
                    addSampleMessages();
                }, 1000);
                
            } catch (error) {
                console.error('Failed to connect WebSocket:', error);
                updateConnectionStatus(false);
            }
        }
        
        function disconnectWebSocket() {
            if (websocket) {
                websocket.close();
                websocket = null;
            }
            updateConnectionStatus(false);
        }
        
        function updateConnectionStatus(connected) {
            const statusElement = document.getElementById('connection-status');
            const connectBtn = document.getElementById('connect-btn');
            
            if (statusElement) {
                if (connected) {
                    statusElement.className = 'status-indicator connected';
                    statusElement.innerHTML = '<i class="fas fa-circle"></i><span>Connected</span>';
                } else {
                    statusElement.className = 'status-indicator disconnected';
                    statusElement.innerHTML = '<i class="fas fa-circle"></i><span>Disconnected</span>';
                }
            }
            
            if (connectBtn) {
                if (connected) {
                    connectBtn.innerHTML = '<i class="fas fa-unlink me-2"></i>Disconnect';
                    connectBtn.className = 'btn btn-secondary';
                } else {
                    connectBtn.innerHTML = '<i class="fas fa-plug me-2"></i>Connect';
                    connectBtn.className = 'btn btn-primary';
                }
            }
        }
        
        function handleMockResponse(message) {
            if (!websocket || !websocket.message) return;
            
            switch (message.type) {
                case 'chat_message':
                    // Echo the message back
                    websocket.message({
                        data: JSON.stringify({
                            type: 'chat_message',
                            id: 'msg_' + Date.now(),
                            message: message.message,
                            user_id: 'demo_user',
                            user_name: currentUserName,
                            user_role: currentUserRole,
                            timestamp: Date.now(),
                            room_id: message.room_id
                        })
                    });
                    break;
            }
        }
        
        // Search test functions
        function testSearch(query) {
            if (searchInterface) {
                searchInterface.openSearch();
                setTimeout(() => {
                    searchInterface.searchInput.value = query;
                    searchInterface.performSearch(query);
                }, 100);
            }
        }
        
        function testRegexSearch() {
            if (searchInterface) {
                // Enable regex mode
                searchInterface.updateSearchSetting('useRegex', true);
                const regexQuery = '\\b(JavaScript|React|Node\\.js)\\b';
                testSearch(regexQuery);
            }
        }
        
        function testFuzzySearch() {
            if (searchInterface) {
                // Enable fuzzy search
                searchInterface.updateSearchSetting('fuzzySearch', true);
                testSearch('algoritm developmnt'); // Intentional typos
            }
        }
        
        function addSampleMessages() {
            if (!websocket || !websocket.message) return;
            
            sampleMessages.forEach((msg, index) => {
                setTimeout(() => {
                    const userName = mockUserNames[index % mockUserNames.length];
                    const userRole = index % 4 === 0 ? 'admin' : index % 3 === 0 ? 'moderator' : 'participant';
                    
                    websocket.message({
                        data: JSON.stringify({
                            type: 'chat_message',
                            id: 'sample_' + Date.now() + '_' + index,
                            message: msg,
                            user_id: 'user_' + (index % mockUserNames.length),
                            user_name: userName,
                            user_role: userRole,
                            timestamp: Date.now() - (sampleMessages.length - index) * 60000, // Spread over time
                            room_id: currentRoomId
                        })
                    });
                }, index * 200); // Stagger message addition
            });
            
            // Update stats after messages are added
            setTimeout(() => {
                updateSearchStats();
            }, sampleMessages.length * 200 + 1000);
        }
        
        function clearSearch() {
            if (searchInterface) {
                searchInterface.clearSearch();
                updateSearchStats();
            }
        }
        
        function openSearchInterface() {
            if (searchInterface) {
                searchInterface.openSearch();
            }
        }
        
        function updateSearchStats() {
            if (searchInterface) {
                const stats = searchInterface.getSearchStatistics();
                
                document.getElementById('total-messages').textContent = stats.totalMessages;
                document.getElementById('indexed-words').textContent = stats.indexedWords;
                document.getElementById('search-history-count').textContent = stats.searchHistory;
                document.getElementById('current-results').textContent = stats.currentResults;
                document.getElementById('search-active').textContent = stats.isSearchActive ? 'Yes' : 'No';
                document.getElementById('current-query').textContent = stats.currentQuery || 'None';
            }
        }
        
        // Auto-connect on page load
        setTimeout(() => {
            connectWebSocket();
        }, 1000);
        
        // Update stats periodically
        setInterval(updateSearchStats, 5000);
    </script>
</body>
</html>
