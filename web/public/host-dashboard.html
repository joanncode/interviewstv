<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Host Dashboard - Interviews.tv</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
            min-height: 100vh;
            color: white;
        }
        .dashboard-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .dashboard-header {
            text-align: center;
            margin-bottom: 40px;
        }
        .dashboard-header h1 {
            color: #FF0000;
            margin-bottom: 10px;
        }
        .card {
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        .card-header {
            background: #333;
            border-bottom: 1px solid #444;
            border-radius: 15px 15px 0 0;
            padding: 15px 20px;
        }
        .card-body {
            padding: 20px;
        }
        .btn-primary {
            background: #FF0000;
            border-color: #FF0000;
            border-radius: 8px;
            font-weight: 600;
        }
        .btn-primary:hover {
            background: #cc0000;
            border-color: #cc0000;
        }
        .form-control, .form-select {
            background: #3a3a3a;
            border: 1px solid #555;
            color: white;
            border-radius: 8px;
        }
        .form-control:focus, .form-select:focus {
            background: #3a3a3a;
            border-color: #FF0000;
            color: white;
            box-shadow: 0 0 0 0.2rem rgba(255, 0, 0, 0.25);
        }
        .room-card {
            background: #333;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #FF0000;
        }
        .room-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }
        .status-scheduled { background: #ffc107; color: #000; }
        .status-live { background: #28a745; color: white; }
        .status-ended { background: #6c757d; color: white; }
        .status-waiting { background: #17a2b8; color: white; }
        .guest-list {
            max-height: 200px;
            overflow-y: auto;
        }
        .guest-item {
            display: flex;
            justify-content: between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #444;
        }
        .guest-item:last-child {
            border-bottom: none;
        }
        .guest-status {
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 10px;
        }
        .guest-pending { background: #ffc107; color: #000; }
        .guest-accepted { background: #28a745; color: white; }
        .guest-declined { background: #dc3545; color: white; }
        .quick-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: #333;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #FF0000;
        }
        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        .modal-content {
            background: #2a2a2a;
            border: 1px solid #444;
        }
        .modal-header {
            border-bottom: 1px solid #444;
        }
        .modal-footer {
            border-top: 1px solid #444;
        }
        .btn-close {
            filter: invert(1);
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <div class="dashboard-header">
            <h1>Host Dashboard</h1>
            <p>Create and manage your interview rooms</p>
            <button class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#createRoomModal">
                <i class="fas fa-plus"></i> Create New Interview Room
            </button>
        </div>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="total-rooms">0</div>
                <div class="stat-label">Total Rooms</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="active-rooms">0</div>
                <div class="stat-label">Active Rooms</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="total-guests">0</div>
                <div class="stat-label">Total Guests</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="completed-interviews">0</div>
                <div class="stat-label">Completed</div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="card mb-4">
            <div class="card-header">
                <h5><i class="fas fa-bolt"></i> Quick Actions & Features</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <a href="transcription-demo.html" class="btn btn-outline-light w-100 h-100 d-flex flex-column align-items-center justify-content-center" style="min-height: 100px;">
                            <i class="fas fa-microphone-alt fa-2x mb-2 text-danger"></i>
                            <strong>AI Transcription</strong>
                            <small class="text-muted mt-1">Real-time speech-to-text</small>
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="translation-demo.html" class="btn btn-outline-light w-100 h-100 d-flex flex-column align-items-center justify-content-center" style="min-height: 100px;">
                            <i class="fas fa-language fa-2x mb-2 text-danger"></i>
                            <strong>Real-time Translation</strong>
                            <small class="text-muted mt-1">Multi-language translation</small>
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="highlights-demo.html" class="btn btn-outline-light w-100 h-100 d-flex flex-column align-items-center justify-content-center" style="min-height: 100px;">
                            <i class="fas fa-star fa-2x mb-2 text-danger"></i>
                            <strong>AI Highlights</strong>
                            <small class="text-muted mt-1">Intelligent key moments</small>
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="smart-camera-demo.html" class="btn btn-outline-light w-100 h-100 d-flex flex-column align-items-center justify-content-center" style="min-height: 100px;">
                            <i class="fas fa-video fa-2x mb-2 text-danger"></i>
                            <strong>Smart Camera</strong>
                            <small class="text-muted mt-1">AI-powered switching</small>
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="content-moderation-demo.html" class="btn btn-outline-light w-100 h-100 d-flex flex-column align-items-center justify-content-center" style="min-height: 100px;">
                            <i class="fas fa-shield-alt fa-2x mb-2 text-danger"></i>
                            <strong>Content Moderation</strong>
                            <small class="text-muted mt-1">AI-powered safety</small>
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="automated-summaries-demo.html" class="btn btn-outline-light w-100 h-100 d-flex flex-column align-items-center justify-content-center" style="min-height: 100px;">
                            <i class="fas fa-file-alt fa-2x mb-2 text-danger"></i>
                            <strong>Automated Summaries</strong>
                            <small class="text-muted mt-1">AI-powered insights</small>
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="sentiment-analysis-demo.html" class="btn btn-outline-light w-100 h-100 d-flex flex-column align-items-center justify-content-center" style="min-height: 100px;">
                            <i class="fas fa-heart-pulse fa-2x mb-2 text-danger"></i>
                            <strong>Sentiment Analysis</strong>
                            <small class="text-muted mt-1">AI emotion detection</small>
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="ai-recommendations-demo.html" class="btn btn-outline-light w-100 h-100 d-flex flex-column align-items-center justify-content-center" style="min-height: 100px;">
                            <i class="fas fa-lightbulb fa-2x mb-2 text-warning"></i>
                            <strong>AI Recommendations</strong>
                            <small class="text-muted mt-1">Smart interview insights</small>
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="analytics-dashboard.html" class="btn btn-outline-light w-100 h-100 d-flex flex-column align-items-center justify-content-center" style="min-height: 100px;">
                            <i class="fas fa-chart-line fa-2x mb-2 text-danger"></i>
                            <strong>Analytics</strong>
                            <small class="text-muted mt-1">View insights & metrics</small>
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="export-import.html" class="btn btn-outline-light w-100 h-100 d-flex flex-column align-items-center justify-content-center" style="min-height: 100px;">
                            <i class="fas fa-exchange-alt fa-2x mb-2 text-danger"></i>
                            <strong>Export/Import</strong>
                            <small class="text-muted mt-1">Manage your data</small>
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="backup-management.html" class="btn btn-outline-light w-100 h-100 d-flex flex-column align-items-center justify-content-center" style="min-height: 100px;">
                            <i class="fas fa-shield-alt fa-2x mb-2 text-danger"></i>
                            <strong>Backup</strong>
                            <small class="text-muted mt-1">System backup & restore</small>
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="calendar-integration-demo.html" class="btn btn-outline-light w-100 h-100 d-flex flex-column align-items-center justify-content-center" style="min-height: 100px;">
                            <i class="fas fa-calendar-alt fa-2x mb-2 text-info"></i>
                            <strong>Calendar Integration</strong>
                            <small class="text-muted mt-1">Google, Outlook & more</small>
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="social-media-streaming-demo.html" class="btn btn-outline-light w-100 h-100 d-flex flex-column align-items-center justify-content-center" style="min-height: 100px;">
                            <i class="fas fa-share-alt fa-2x mb-2 text-success"></i>
                            <strong>Social Media Streaming</strong>
                            <small class="text-muted mt-1">YouTube, Facebook & more</small>
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="webhook-notifications-demo.html" class="btn btn-outline-light w-100 h-100 d-flex flex-column align-items-center justify-content-center" style="min-height: 100px;">
                            <i class="fas fa-webhook fa-2x mb-2 text-warning"></i>
                            <strong>Webhook Notifications</strong>
                            <small class="text-muted mt-1">Real-time event notifications</small>
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="third-party-integrations-demo.html" class="btn btn-outline-light w-100 h-100 d-flex flex-column align-items-center justify-content-center" style="min-height: 100px;">
                            <i class="fas fa-plug fa-2x mb-2 text-info"></i>
                            <strong>Third-Party Integrations</strong>
                            <small class="text-muted mt-1">Connect business tools</small>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Interview Rooms -->
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-video"></i> Your Interview Rooms</h5>
            </div>
            <div class="card-body">
                <div id="rooms-list">
                    <!-- Rooms will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Create Room Modal -->
    <div class="modal fade" id="createRoomModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create Interview Room</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="create-room-form">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="room-title" class="form-label">Interview Title</label>
                                    <input type="text" class="form-control" id="room-title" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="scheduled-start" class="form-label">Scheduled Start</label>
                                    <input type="datetime-local" class="form-control" id="scheduled-start" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="room-description" class="form-label">Description</label>
                            <textarea class="form-control" id="room-description" rows="3"></textarea>
                        </div>

                        <!-- Interview Template Selection -->
                        <div class="mb-4">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <label class="form-label mb-0">Interview Template (Optional)</label>
                                <a href="interview-templates.html" target="_blank" class="btn btn-outline-light btn-sm">
                                    <i class="fas fa-external-link-alt me-1"></i> Browse Templates
                                </a>
                            </div>
                            <select class="form-select" id="interview-template">
                                <option value="">No template - Custom interview</option>
                            </select>
                            <div class="form-text text-muted">
                                Templates provide pre-defined questions and structure for your interview
                            </div>

                            <!-- Template Preview -->
                            <div id="template-preview" class="mt-3 p-3 bg-dark rounded d-none">
                                <h6 class="text-white mb-2">
                                    <i class="fas fa-eye text-danger me-1"></i> Template Preview
                                </h6>
                                <div id="template-preview-content"></div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="max-guests" class="form-label">Maximum Guests</label>
                                    <select class="form-select" id="max-guests">
                                        <option value="5">5 guests</option>
                                        <option value="10" selected>10 guests</option>
                                        <option value="20">20 guests</option>
                                        <option value="50">50 guests</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="scheduled-end" class="form-label">Scheduled End (Optional)</label>
                                    <input type="datetime-local" class="form-control" id="scheduled-end">
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="recording-enabled" checked>
                                    <label class="form-check-label" for="recording-enabled">
                                        Enable Recording
                                    </label>
                                </div>
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="auto-recording-enabled">
                                    <label class="form-check-label" for="auto-recording-enabled">
                                        Auto-start Recording
                                    </label>
                                    <small class="form-text text-muted">Automatically start recording when guests join</small>
                                </div>
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="chat-enabled" checked>
                                    <label class="form-check-label" for="chat-enabled">
                                        Enable Chat
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="waiting-room-enabled" checked>
                                    <label class="form-check-label" for="waiting-room-enabled">
                                        Enable Waiting Room
                                    </label>
                                </div>
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="guest-approval-required">
                                    <label class="form-check-label" for="guest-approval-required">
                                        Require Guest Approval
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Create Room</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Invite Guests Modal -->
    <div class="modal fade" id="inviteGuestsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Invite Guests</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="invite-guests-form">
                    <div class="modal-body">
                        <div id="guest-inputs">
                            <div class="guest-input-group mb-3">
                                <div class="row">
                                    <div class="col-md-6">
                                        <input type="email" class="form-control" placeholder="Guest email" required>
                                    </div>
                                    <div class="col-md-4">
                                        <input type="text" class="form-control" placeholder="Guest name (optional)">
                                    </div>
                                    <div class="col-md-2">
                                        <select class="form-select">
                                            <option value="guest">Guest</option>
                                            <option value="co-host">Co-host</option>
                                            <option value="viewer">Viewer</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-outline-light btn-sm" id="add-guest-btn">
                            <i class="fas fa-plus"></i> Add Another Guest
                        </button>
                        
                        <div class="mt-3">
                            <label for="custom-message" class="form-label">Custom Message (Optional)</label>
                            <textarea class="form-control" id="custom-message" rows="3" placeholder="Add a personal message to the invitation..."></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Send Invitations</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/bootstrap.bundle.min.js"></script>
    <script>
        class HostDashboard {
            constructor() {
                this.currentRoomId = null;
                this.init();
            }

            init() {
                this.bindEvents();
                this.loadDashboardData();
                this.setDefaultDateTime();
                this.loadInterviewTemplates();
                this.setupTemplateHandlers();
            }

            bindEvents() {
                // Create room form
                document.getElementById('create-room-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.createRoom();
                });

                // Invite guests form
                document.getElementById('invite-guests-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.inviteGuests();
                });

                // Add guest button
                document.getElementById('add-guest-btn').addEventListener('click', () => {
                    this.addGuestInput();
                });
            }

            setDefaultDateTime() {
                const now = new Date();
                now.setMinutes(now.getMinutes() + 30); // Default to 30 minutes from now
                document.getElementById('scheduled-start').value = now.toISOString().slice(0, 16);
            }

            async loadDashboardData() {
                try {
                    const response = await fetch('/api/interview-rooms', {
                        headers: {
                            'Authorization': `Bearer ${this.getAuthToken()}`
                        }
                    });

                    const data = await response.json();

                    if (data.success) {
                        this.updateStats(data.data);
                        this.renderRooms(data.data.rooms);
                    }
                } catch (error) {
                    console.error('Failed to load dashboard data:', error);
                }
            }

            updateStats(data) {
                document.getElementById('total-rooms').textContent = data.total || 0;
                document.getElementById('active-rooms').textContent = 
                    data.rooms?.filter(room => room.status === 'live' || room.status === 'waiting').length || 0;
                document.getElementById('total-guests').textContent = 
                    data.rooms?.reduce((sum, room) => sum + (room.accepted_guests || 0), 0) || 0;
                document.getElementById('completed-interviews').textContent = 
                    data.rooms?.filter(room => room.status === 'ended').length || 0;
            }

            renderRooms(rooms) {
                const container = document.getElementById('rooms-list');
                
                if (!rooms || rooms.length === 0) {
                    container.innerHTML = '<p class="text-center text-muted">No interview rooms yet. Create your first room!</p>';
                    return;
                }

                container.innerHTML = rooms.map(room => this.createRoomCard(room)).join('');
            }

            createRoomCard(room) {
                const statusClass = `status-${room.status}`;
                const scheduledDate = new Date(room.scheduled_start).toLocaleString();
                
                return `
                    <div class="room-card">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div>
                                <h5>${room.title}</h5>
                                <p class="text-muted mb-2">${room.description || 'No description'}</p>
                                <small class="text-muted">Scheduled: ${scheduledDate}</small>
                            </div>
                            <span class="room-status ${statusClass}">${room.status.toUpperCase()}</span>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-3">
                                <small class="text-muted">Room Code:</small><br>
                                <strong>${room.room_code}</strong>
                            </div>
                            <div class="col-md-3">
                                <small class="text-muted">Invited:</small><br>
                                <strong>${room.invited_guests || 0}</strong>
                            </div>
                            <div class="col-md-3">
                                <small class="text-muted">Accepted:</small><br>
                                <strong>${room.accepted_guests || 0}</strong>
                            </div>
                            <div class="col-md-3">
                                <small class="text-muted">Max Guests:</small><br>
                                <strong>${room.max_guests}</strong>
                            </div>
                        </div>

                        <div class="quick-actions">
                            ${room.status === 'scheduled' ? `
                                <button class="btn btn-primary btn-sm" onclick="hostDashboard.inviteGuestsToRoom('${room.id}')">
                                    <i class="fas fa-user-plus"></i> Invite Guests
                                </button>
                                <button class="btn btn-success btn-sm" onclick="hostDashboard.startInterview('${room.id}')">
                                    <i class="fas fa-play"></i> Start Interview
                                </button>
                            ` : ''}
                            ${room.status === 'live' || room.status === 'waiting' ? `
                                <button class="btn btn-success btn-sm" onclick="hostDashboard.joinInterview('${room.id}')">
                                    <i class="fas fa-video"></i> Join Interview
                                </button>
                            ` : ''}
                            <button class="btn btn-outline-light btn-sm" onclick="hostDashboard.viewRoomDetails('${room.id}')">
                                <i class="fas fa-eye"></i> View Details
                            </button>
                            <button class="btn btn-outline-danger btn-sm" onclick="hostDashboard.deleteRoom('${room.id}')">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                `;
            }

            async createRoom() {
                const templateId = document.getElementById('interview-template').value;

                const formData = {
                    title: document.getElementById('room-title').value,
                    description: document.getElementById('room-description').value,
                    scheduled_start: document.getElementById('scheduled-start').value,
                    scheduled_end: document.getElementById('scheduled-end').value || null,
                    max_guests: parseInt(document.getElementById('max-guests').value),
                    recording_enabled: document.getElementById('recording-enabled').checked,
                    auto_recording_enabled: document.getElementById('auto-recording-enabled').checked,
                    chat_enabled: document.getElementById('chat-enabled').checked,
                    waiting_room_enabled: document.getElementById('waiting-room-enabled').checked,
                    guest_approval_required: document.getElementById('guest-approval-required').checked,
                    template_id: templateId || null
                };

                try {
                    const response = await fetch('/api/interview-rooms', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${this.getAuthToken()}`
                        },
                        body: JSON.stringify(formData)
                    });

                    const data = await response.json();

                    if (data.success) {
                        bootstrap.Modal.getInstance(document.getElementById('createRoomModal')).hide();
                        document.getElementById('create-room-form').reset();
                        this.setDefaultDateTime();
                        this.loadDashboardData();
                        alert('Interview room created successfully!');
                    } else {
                        alert('Failed to create room: ' + data.message);
                    }
                } catch (error) {
                    alert('Network error. Please try again.');
                }
            }

            inviteGuestsToRoom(roomId) {
                this.currentRoomId = roomId;
                const modal = new bootstrap.Modal(document.getElementById('inviteGuestsModal'));
                modal.show();
            }

            addGuestInput() {
                const container = document.getElementById('guest-inputs');
                const guestInput = document.createElement('div');
                guestInput.className = 'guest-input-group mb-3';
                guestInput.innerHTML = `
                    <div class="row">
                        <div class="col-md-6">
                            <input type="email" class="form-control" placeholder="Guest email" required>
                        </div>
                        <div class="col-md-4">
                            <input type="text" class="form-control" placeholder="Guest name (optional)">
                        </div>
                        <div class="col-md-2">
                            <select class="form-select">
                                <option value="guest">Guest</option>
                                <option value="co-host">Co-host</option>
                                <option value="viewer">Viewer</option>
                            </select>
                        </div>
                    </div>
                `;
                container.appendChild(guestInput);
            }

            async inviteGuests() {
                const guestInputs = document.querySelectorAll('.guest-input-group');
                const guests = [];

                guestInputs.forEach(input => {
                    const email = input.querySelector('input[type="email"]').value.trim();
                    const name = input.querySelector('input[type="text"]').value.trim();
                    const role = input.querySelector('select').value;

                    if (email) {
                        guests.push({ email, name, role });
                    }
                });

                if (guests.length === 0) {
                    alert('Please add at least one guest email');
                    return;
                }

                try {
                    const response = await fetch(`/api/interview-rooms/${this.currentRoomId}/invite`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${this.getAuthToken()}`
                        },
                        body: JSON.stringify({
                            guests: guests,
                            send_email: true
                        })
                    });

                    const data = await response.json();

                    if (data.success) {
                        bootstrap.Modal.getInstance(document.getElementById('inviteGuestsModal')).hide();
                        document.getElementById('invite-guests-form').reset();
                        this.loadDashboardData();
                        alert(`Successfully sent ${guests.length} invitation(s)!`);
                    } else {
                        alert('Failed to send invitations: ' + data.message);
                    }
                } catch (error) {
                    alert('Network error. Please try again.');
                }
            }

            startInterview(roomId) {
                // Update room status to 'waiting' or 'live'
                window.location.href = `/interview-room/${roomId}`;
            }

            joinInterview(roomId) {
                window.location.href = `/interview-room/${roomId}`;
            }

            viewRoomDetails(roomId) {
                // Show room details modal or navigate to details page
                console.log('View room details:', roomId);
            }

            async deleteRoom(roomId) {
                if (!confirm('Are you sure you want to delete this interview room?')) {
                    return;
                }

                try {
                    const response = await fetch(`/api/interview-rooms/${roomId}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${this.getAuthToken()}`
                        }
                    });

                    const data = await response.json();

                    if (data.success) {
                        this.loadDashboardData();
                        alert('Interview room deleted successfully');
                    } else {
                        alert('Failed to delete room: ' + data.message);
                    }
                } catch (error) {
                    alert('Network error. Please try again.');
                }
            }

            async loadInterviewTemplates() {
                try {
                    const response = await fetch('/api/interview-templates?public=true&featured=true');
                    const data = await response.json();

                    if (data.success) {
                        const templateSelect = document.getElementById('interview-template');
                        templateSelect.innerHTML = '<option value="">No template - Custom interview</option>';

                        data.data.forEach(template => {
                            const option = document.createElement('option');
                            option.value = template.id;
                            option.textContent = `${template.name} (${template.duration_minutes}min, ${template.type})`;
                            option.dataset.template = JSON.stringify(template);
                            templateSelect.appendChild(option);
                        });
                    }
                } catch (error) {
                    console.error('Failed to load templates:', error);
                }
            }

            setupTemplateHandlers() {
                const templateSelect = document.getElementById('interview-template');
                templateSelect.addEventListener('change', (e) => {
                    this.handleTemplateSelection(e.target.value, e.target.selectedOptions[0]);
                });

                // Check for template parameter in URL
                const urlParams = new URLSearchParams(window.location.search);
                const templateId = urlParams.get('template');
                if (templateId) {
                    setTimeout(() => {
                        templateSelect.value = templateId;
                        this.handleTemplateSelection(templateId, templateSelect.selectedOptions[0]);
                    }, 1000);
                }
            }

            handleTemplateSelection(templateId, option) {
                const preview = document.getElementById('template-preview');
                const previewContent = document.getElementById('template-preview-content');

                if (!templateId || !option.dataset.template) {
                    preview.classList.add('d-none');
                    return;
                }

                const template = JSON.parse(option.dataset.template);
                const questions = JSON.parse(template.questions || '[]');
                const settings = JSON.parse(template.settings || '{}');

                // Apply template settings to form
                if (settings.recording_enabled !== undefined) {
                    document.getElementById('recording-enabled').checked = settings.recording_enabled;
                }
                if (settings.auto_recording_enabled !== undefined) {
                    document.getElementById('auto-recording-enabled').checked = settings.auto_recording_enabled;
                }
                if (settings.chat_enabled !== undefined) {
                    document.getElementById('chat-enabled').checked = settings.chat_enabled;
                }
                if (settings.waiting_room_enabled !== undefined) {
                    document.getElementById('waiting-room-enabled').checked = settings.waiting_room_enabled;
                }
                if (settings.guest_approval_required !== undefined) {
                    document.getElementById('guest-approval-required').checked = settings.guest_approval_required;
                }

                // Set max guests if specified
                if (template.max_guests) {
                    document.getElementById('max-guests').value = template.max_guests;
                }

                // Show template preview
                const questionsPreview = questions.slice(0, 5).map((q, index) => `
                    <div class="d-flex justify-content-between align-items-start mb-1">
                        <span class="small">${index + 1}. ${q.text}</span>
                        <span class="badge bg-secondary small">${q.time_limit || 5}min</span>
                    </div>
                `).join('');

                previewContent.innerHTML = `
                    <div class="row">
                        <div class="col-md-6">
                            <strong class="text-white">Duration:</strong> ${template.duration_minutes} minutes<br>
                            <strong class="text-white">Type:</strong> ${template.type}<br>
                            <strong class="text-white">Questions:</strong> ${questions.length}
                        </div>
                        <div class="col-md-6">
                            <strong class="text-white">Sample Questions:</strong>
                            <div class="mt-1">
                                ${questionsPreview}
                                ${questions.length > 5 ? `<small class="text-muted">+${questions.length - 5} more...</small>` : ''}
                            </div>
                        </div>
                    </div>
                `;

                preview.classList.remove('d-none');
            }

            getAuthToken() {
                // This would typically get the JWT token from localStorage or cookies
                return localStorage.getItem('auth_token') || '';
            }
        }

        // Initialize dashboard
        let hostDashboard;
        document.addEventListener('DOMContentLoaded', () => {
            hostDashboard = new HostDashboard();
        });
    </script>
</body>
</html>
