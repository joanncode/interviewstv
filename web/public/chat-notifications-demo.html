<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Notifications & Sounds - Interviews.tv</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom Dark Theme CSS -->
    <style>
        :root {
            --primary-color: #FF0000;
            --bg-dark: #1a1a1a;
            --card-dark: #2a2a2a;
            --input-dark: #3a3a3a;
            --text-light: #ffffff;
            --text-muted: #cccccc;
            --border-color: #444444;
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-light);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
        }

        .navbar {
            background-color: var(--card-dark) !important;
            border-bottom: 2px solid var(--primary-color);
            flex-shrink: 0;
        }

        .navbar-brand {
            color: var(--primary-color) !important;
            font-weight: bold;
            font-size: 1.5rem;
        }

        .navbar-nav .nav-link {
            color: var(--text-light) !important;
        }

        .navbar-nav .nav-link:hover {
            color: var(--primary-color) !important;
        }

        .main-container {
            display: flex;
            height: calc(100vh - 76px);
        }

        .demo-sidebar {
            width: 350px;
            background: var(--card-dark);
            border-right: 1px solid var(--border-color);
            padding: 1.5rem;
            overflow-y: auto;
            flex-shrink: 0;
        }

        .demo-section {
            margin-bottom: 2rem;
        }

        .demo-section h5 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .demo-controls {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .status-indicator.connected {
            background-color: rgba(40, 167, 69, 0.2);
            color: #28a745;
            border: 1px solid #28a745;
        }

        .status-indicator.disconnected {
            background-color: rgba(220, 53, 69, 0.2);
            color: #dc3545;
            border: 1px solid #dc3545;
        }

        .demo-control {
            background: var(--input-dark);
            border: 1px solid var(--border-color);
            color: var(--text-light);
            border-radius: 6px;
            padding: 0.5rem 0.75rem;
            font-size: 0.9rem;
        }

        .demo-control:focus {
            outline: none;
            border-color: var(--primary-color);
            color: var(--text-light);
        }

        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .btn-primary:hover {
            background-color: #cc0000;
            border-color: #cc0000;
        }

        .btn-secondary {
            background-color: var(--input-dark);
            border-color: var(--border-color);
            color: var(--text-light);
        }

        .btn-secondary:hover {
            background-color: #4a4a4a;
            border-color: #555;
            color: var(--text-light);
        }

        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
            position: relative;
        }

        .demo-info {
            background: rgba(23, 162, 184, 0.1);
            border: 1px solid #17a2b8;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .demo-info h6 {
            color: #17a2b8;
            margin-bottom: 0.5rem;
        }

        .demo-info p {
            color: var(--text-muted);
            margin-bottom: 0;
            font-size: 0.9rem;
        }

        .feature-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .feature-list li {
            padding: 0.25rem 0;
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .feature-list li i {
            color: var(--primary-color);
            width: 16px;
            margin-right: 0.5rem;
        }

        .notification-demo-controls {
            background: var(--input-dark);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .notification-demo-controls h6 {
            color: var(--text-light);
            margin-bottom: 0.75rem;
        }

        .simulation-btn {
            background: var(--card-dark);
            border: 1px solid var(--border-color);
            color: var(--text-light);
            padding: 0.4rem 0.8rem;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
            margin: 0.25rem;
        }

        .simulation-btn:hover {
            background: var(--primary-color);
            border-color: var(--primary-color);
        }

        .simulation-btn.message { border-color: #17a2b8; }
        .simulation-btn.mention { border-color: #ffc107; }
        .simulation-btn.private { border-color: #6f42c1; }
        .simulation-btn.join { border-color: #28a745; }
        .simulation-btn.leave { border-color: #6c757d; }
        .simulation-btn.system { border-color: #fd7e14; }
        .simulation-btn.error { border-color: #dc3545; }
        .simulation-btn.success { border-color: #28a745; }

        .permission-status {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .permission-status h6 {
            color: #ffc107;
            margin-bottom: 0.75rem;
        }

        .permission-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.25rem 0;
            font-size: 0.9rem;
        }

        .permission-label {
            color: var(--text-muted);
        }

        .permission-value {
            font-weight: 600;
        }

        .permission-value.granted {
            color: #28a745;
        }

        .permission-value.denied {
            color: #dc3545;
        }

        .permission-value.pending {
            color: #ffc107;
        }

        .sound-demo-controls {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid var(--primary-color);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .sound-demo-controls h6 {
            color: var(--primary-color);
            margin-bottom: 0.75rem;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 0.5rem 0;
        }

        .volume-slider {
            flex: 1;
            background: var(--input-dark);
            border: none;
            height: 6px;
            border-radius: 3px;
            outline: none;
        }

        .volume-slider::-webkit-slider-thumb {
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
        }

        .volume-value {
            color: var(--text-muted);
            font-size: 0.8rem;
            font-weight: 500;
            min-width: 35px;
            text-align: right;
        }

        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }
            
            .demo-sidebar {
                width: 100%;
                height: auto;
                max-height: 300px;
                padding: 1rem;
            }
            
            .demo-controls {
                flex-direction: row;
                flex-wrap: wrap;
            }
        }

        /* Highlight animation for messages and users */
        .highlighted {
            background: rgba(255, 0, 0, 0.2) !important;
            border: 1px solid var(--primary-color) !important;
            animation: highlight-pulse 2s ease-in-out;
        }

        @keyframes highlight-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Pulse animation for sound feedback */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-video me-2"></i>Interviews.tv
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="interview-room.html">
                            <i class="fas fa-comments me-1"></i>Basic Chat
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="chat-moderation-demo.html">
                            <i class="fas fa-shield-alt me-1"></i>Moderation
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="private-messaging-demo.html">
                            <i class="fas fa-envelope me-1"></i>Private Messages
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="chat-export-demo.html">
                            <i class="fas fa-download me-1"></i>Export
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="modern-chat-demo.html">
                            <i class="fas fa-sparkles me-1"></i>Modern Chat
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="message-threading-demo.html">
                            <i class="fas fa-comments me-1"></i>Threading
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="typing-indicators-demo.html">
                            <i class="fas fa-keyboard me-1"></i>Typing
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="user-list-demo.html">
                            <i class="fas fa-users me-1"></i>User List
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="chat-notifications-demo.html">
                            <i class="fas fa-bell me-1"></i>Notifications
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="main-container">
        <!-- Demo Sidebar -->
        <div class="demo-sidebar">
            <!-- Connection Status -->
            <div class="demo-section">
                <h5><i class="fas fa-wifi me-2"></i>Connection</h5>
                <div class="demo-controls">
                    <div class="status-indicator disconnected" id="connection-status">
                        <i class="fas fa-circle"></i>
                        <span>Disconnected</span>
                    </div>
                    <button class="btn btn-primary" id="connect-btn">
                        <i class="fas fa-plug me-2"></i>Connect
                    </button>
                </div>
            </div>

            <!-- User Settings -->
            <div class="demo-section">
                <h5><i class="fas fa-user me-2"></i>User Settings</h5>
                <div class="demo-controls">
                    <select class="demo-control" id="user-role">
                        <option value="participant">Participant</option>
                        <option value="host">Host</option>
                        <option value="moderator">Moderator</option>
                        <option value="admin" selected>Admin</option>
                    </select>
                    <input type="text" class="demo-control" id="user-name" placeholder="Your name" value="Demo User">
                    <input type="text" class="demo-control" id="room-id" placeholder="Room ID" value="demo_room">
                </div>
            </div>

            <!-- Notification Features -->
            <div class="demo-section">
                <h5><i class="fas fa-bell me-2"></i>Notification Features</h5>
                <ul class="feature-list">
                    <li><i class="fas fa-check"></i>Desktop notifications</li>
                    <li><i class="fas fa-check"></i>Toast notifications</li>
                    <li><i class="fas fa-check"></i>Sound alerts</li>
                    <li><i class="fas fa-check"></i>Title notifications</li>
                    <li><i class="fas fa-check"></i>Badge notifications</li>
                    <li><i class="fas fa-check"></i>Mention detection</li>
                    <li><i class="fas fa-check"></i>Private message alerts</li>
                    <li><i class="fas fa-check"></i>User join/leave sounds</li>
                    <li><i class="fas fa-check"></i>System notifications</li>
                    <li><i class="fas fa-check"></i>Customizable settings</li>
                </ul>
            </div>

            <!-- Permission Status -->
            <div class="permission-status">
                <h6><i class="fas fa-shield-alt me-2"></i>Browser Permissions</h6>
                <div class="permission-item">
                    <span class="permission-label">Desktop Notifications:</span>
                    <span class="permission-value pending" id="notification-permission">Checking...</span>
                </div>
                <div class="permission-item">
                    <span class="permission-label">Audio Context:</span>
                    <span class="permission-value pending" id="audio-permission">Checking...</span>
                </div>
                <div class="permission-item">
                    <span class="permission-label">Document Visibility:</span>
                    <span class="permission-value" id="visibility-status">Visible</span>
                </div>
                <div class="permission-item">
                    <span class="permission-label">Window Focus:</span>
                    <span class="permission-value" id="focus-status">Focused</span>
                </div>
            </div>

            <!-- Sound Demo Controls -->
            <div class="sound-demo-controls">
                <h6><i class="fas fa-volume-up me-2"></i>Sound Testing</h6>
                <div class="volume-control">
                    <i class="fas fa-volume-down"></i>
                    <input type="range" class="volume-slider" id="volume-slider" min="0" max="1" step="0.1" value="0.7">
                    <i class="fas fa-volume-up"></i>
                    <span class="volume-value" id="volume-value">70%</span>
                </div>
                
                <div style="margin-top: 0.75rem;">
                    <button class="simulation-btn message" onclick="testSound('message')">
                        <i class="fas fa-comment me-1"></i>Message
                    </button>
                    <button class="simulation-btn mention" onclick="testSound('mention')">
                        <i class="fas fa-at me-1"></i>Mention
                    </button>
                    <button class="simulation-btn private" onclick="testSound('private')">
                        <i class="fas fa-envelope me-1"></i>Private
                    </button>
                    <button class="simulation-btn join" onclick="testSound('join')">
                        <i class="fas fa-user-plus me-1"></i>Join
                    </button>
                    <button class="simulation-btn leave" onclick="testSound('leave')">
                        <i class="fas fa-user-minus me-1"></i>Leave
                    </button>
                    <button class="simulation-btn system" onclick="testSound('system')">
                        <i class="fas fa-cog me-1"></i>System
                    </button>
                    <button class="simulation-btn error" onclick="testSound('error')">
                        <i class="fas fa-exclamation-triangle me-1"></i>Error
                    </button>
                    <button class="simulation-btn success" onclick="testSound('success')">
                        <i class="fas fa-check-circle me-1"></i>Success
                    </button>
                </div>
            </div>

            <!-- Notification Demo Controls -->
            <div class="notification-demo-controls">
                <h6><i class="fas fa-robot me-2"></i>Notification Testing</h6>
                <button class="simulation-btn message" onclick="testNotification('message')">
                    <i class="fas fa-comment me-1"></i>Test Message
                </button>
                <button class="simulation-btn mention" onclick="testNotification('mention')">
                    <i class="fas fa-at me-1"></i>Test Mention
                </button>
                <button class="simulation-btn private" onclick="testNotification('private')">
                    <i class="fas fa-envelope me-1"></i>Test Private
                </button>
                <button class="simulation-btn system" onclick="testNotification('system')">
                    <i class="fas fa-cog me-1"></i>Test System
                </button>
                <button class="simulation-btn error" onclick="testNotification('error')">
                    <i class="fas fa-exclamation-triangle me-1"></i>Test Error
                </button>
                <button class="simulation-btn success" onclick="testNotification('success')">
                    <i class="fas fa-check-circle me-1"></i>Test Success
                </button>
                
                <div style="margin-top: 0.75rem;">
                    <button class="simulation-btn" onclick="simulateUserJoin()">
                        <i class="fas fa-user-plus me-1"></i>User Join
                    </button>
                    <button class="simulation-btn" onclick="simulateUserLeave()">
                        <i class="fas fa-user-minus me-1"></i>User Leave
                    </button>
                    <button class="simulation-btn" onclick="simulateMentionMessage()">
                        <i class="fas fa-at me-1"></i>Mention Message
                    </button>
                    <button class="simulation-btn" onclick="simulatePrivateMessage()">
                        <i class="fas fa-envelope me-1"></i>Private Message
                    </button>
                    <button class="simulation-btn" onclick="clearAllNotifications()">
                        <i class="fas fa-trash me-1"></i>Clear All
                    </button>
                </div>
            </div>
        </div>

        <!-- Chat Container -->
        <div class="chat-container">
            <!-- Demo Info -->
            <div class="demo-info">
                <h6><i class="fas fa-info-circle me-2"></i>Chat Notifications & Sounds</h6>
                <p>Experience comprehensive notification system with desktop notifications, toast alerts, sound feedback, and visual indicators. Test different notification types, adjust settings, and see how the system handles various chat events with professional audio and visual feedback.</p>
            </div>

            <!-- Chat Interface -->
            <div id="modern-chat-container" style="flex: 1;"></div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Chat Components -->
    <script src="../src/components/EmojiInterface.js"></script>
    <script src="../src/components/ChatModerationInterface.js"></script>
    <script src="../src/components/ChatCommandInterface.js"></script>
    <script src="../src/components/PrivateMessageInterface.js"></script>
    <script src="../src/components/ChatExportInterface.js"></script>
    <script src="../src/components/MessageThreadingInterface.js"></script>
    <script src="../src/components/TypingIndicatorInterface.js"></script>
    <script src="../src/components/UserListInterface.js"></script>
    <script src="../src/components/ChatNotificationInterface.js"></script>
    <script src="../src/components/ModernChatInterface.js"></script>
    
    <!-- Demo Script -->
    <script>
        let websocket = null;
        let modernChatInterface = null;
        let notificationInterface = null;
        let currentUserRole = 'admin';
        let currentUserName = 'Demo User';
        let currentRoomId = 'demo_room';
        
        // Mock data for simulation
        const mockUserNames = [
            'Alice Johnson', 'Bob Smith', 'Carol Davis', 'David Wilson', 'Emma Brown',
            'Frank Miller', 'Grace Lee', 'Henry Taylor', 'Ivy Chen', 'Jack Anderson'
        ];
        
        const mockMessages = [
            "Welcome to the interview! Let's start with introductions.",
            "Hi everyone! I'm excited to be here today.",
            "Could you tell us about your background in software development?",
            "I have 5 years of experience working with JavaScript and React.",
            "That's impressive! What's your favorite project you've worked on?",
            "I built a real-time chat application with WebSocket support.",
            "@Demo User what do you think about this approach?",
            "Great question! I think that's a solid foundation.",
            "Thanks for the feedback, it's very helpful.",
            "Let's move on to the next topic."
        ];
        
        // Initialize demo
        document.addEventListener('DOMContentLoaded', function() {
            initializeDemo();
            attachEventListeners();
            checkPermissions();
        });
        
        function initializeDemo() {
            // Initialize modern chat interface with notifications
            const container = document.getElementById('modern-chat-container');
            
            if (typeof ModernChatInterface !== 'undefined') {
                modernChatInterface = new ModernChatInterface({
                    container: container,
                    websocket: websocket,
                    currentUserId: 'demo_user',
                    currentUserRole: currentUserRole,
                    roomId: currentRoomId,
                    settings: {
                        theme: 'dark',
                        fontSize: 'medium',
                        soundEnabled: true,
                        notificationsEnabled: true,
                        showTimestamps: true,
                        showAvatars: true,
                        compactMode: false,
                        autoScroll: true
                    }
                });
                
                // Set global reference
                window.modernChat = modernChatInterface;
                
                // Get notification interface reference
                notificationInterface = modernChatInterface.notificationInterface;
                window.chatNotifications = notificationInterface;
            }
        }
        
        function attachEventListeners() {
            // Connect button
            document.getElementById('connect-btn')?.addEventListener('click', toggleConnection);
            
            // User settings
            document.getElementById('user-role')?.addEventListener('change', (e) => {
                currentUserRole = e.target.value;
                if (modernChatInterface) {
                    modernChatInterface.setUserInfo('demo_user', currentUserRole);
                }
            });
            
            document.getElementById('user-name')?.addEventListener('change', (e) => {
                currentUserName = e.target.value;
            });
            
            document.getElementById('room-id')?.addEventListener('change', (e) => {
                currentRoomId = e.target.value;
                if (modernChatInterface) {
                    modernChatInterface.setRoomId(currentRoomId);
                }
            });
            
            // Volume control
            const volumeSlider = document.getElementById('volume-slider');
            const volumeValue = document.getElementById('volume-value');
            
            volumeSlider?.addEventListener('input', (e) => {
                const volume = parseFloat(e.target.value);
                volumeValue.textContent = Math.round(volume * 100) + '%';
                
                if (notificationInterface) {
                    notificationInterface.updateNotificationSetting('soundVolume', volume);
                }
            });
            
            // Document visibility and focus tracking
            document.addEventListener('visibilitychange', updateVisibilityStatus);
            window.addEventListener('focus', updateFocusStatus);
            window.addEventListener('blur', updateFocusStatus);
        }
        
        function checkPermissions() {
            // Check notification permission
            if ('Notification' in window) {
                const permission = Notification.permission;
                updatePermissionStatus('notification-permission', permission);
                
                if (permission === 'default') {
                    // Request permission on first interaction
                    document.addEventListener('click', async () => {
                        const newPermission = await Notification.requestPermission();
                        updatePermissionStatus('notification-permission', newPermission);
                    }, { once: true });
                }
            } else {
                updatePermissionStatus('notification-permission', 'not-supported');
            }
            
            // Check audio context
            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                if (AudioContext) {
                    updatePermissionStatus('audio-permission', 'granted');
                } else {
                    updatePermissionStatus('audio-permission', 'not-supported');
                }
            } catch (error) {
                updatePermissionStatus('audio-permission', 'denied');
            }
            
            // Initial status
            updateVisibilityStatus();
            updateFocusStatus();
        }
        
        function updatePermissionStatus(elementId, status) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            element.className = 'permission-value';
            
            switch (status) {
                case 'granted':
                    element.textContent = 'Granted';
                    element.classList.add('granted');
                    break;
                case 'denied':
                    element.textContent = 'Denied';
                    element.classList.add('denied');
                    break;
                case 'default':
                    element.textContent = 'Pending';
                    element.classList.add('pending');
                    break;
                case 'not-supported':
                    element.textContent = 'Not Supported';
                    element.classList.add('denied');
                    break;
                default:
                    element.textContent = 'Unknown';
                    element.classList.add('pending');
            }
        }
        
        function updateVisibilityStatus() {
            const element = document.getElementById('visibility-status');
            if (element) {
                element.textContent = document.hidden ? 'Hidden' : 'Visible';
                element.className = 'permission-value ' + (document.hidden ? 'denied' : 'granted');
            }
        }
        
        function updateFocusStatus() {
            const element = document.getElementById('focus-status');
            if (element) {
                element.textContent = document.hasFocus() ? 'Focused' : 'Blurred';
                element.className = 'permission-value ' + (document.hasFocus() ? 'granted' : 'denied');
            }
        }
        
        function toggleConnection() {
            if (websocket && websocket.readyState === WebSocket.OPEN) {
                disconnectWebSocket();
            } else {
                connectWebSocket();
            }
        }
        
        function connectWebSocket() {
            try {
                // Simulate WebSocket connection
                websocket = {
                    readyState: WebSocket.OPEN,
                    send: function(data) {
                        console.log('Sending:', JSON.parse(data));
                        // Simulate server responses
                        setTimeout(() => {
                            const message = JSON.parse(data);
                            handleMockResponse(message);
                        }, 100);
                    },
                    addEventListener: function(event, handler) {
                        this[event] = handler;
                    },
                    close: function() {
                        this.readyState = WebSocket.CLOSED;
                        if (this.onclose) this.onclose();
                    }
                };
                
                console.log('Mock WebSocket connected');
                updateConnectionStatus(true);
                
                // Update chat interface
                if (modernChatInterface) {
                    modernChatInterface.setWebSocket(websocket);
                }
                
                // Add some initial messages
                setTimeout(() => {
                    mockMessages.slice(0, 3).forEach((msg, index) => {
                        setTimeout(() => {
                            simulateMessage(msg);
                        }, index * 1000);
                    });
                }, 1000);
                
            } catch (error) {
                console.error('Failed to connect WebSocket:', error);
                updateConnectionStatus(false);
            }
        }
        
        function disconnectWebSocket() {
            if (websocket) {
                websocket.close();
                websocket = null;
            }
            updateConnectionStatus(false);
        }
        
        function updateConnectionStatus(connected) {
            const statusElement = document.getElementById('connection-status');
            const connectBtn = document.getElementById('connect-btn');
            
            if (statusElement) {
                if (connected) {
                    statusElement.className = 'status-indicator connected';
                    statusElement.innerHTML = '<i class="fas fa-circle"></i><span>Connected</span>';
                } else {
                    statusElement.className = 'status-indicator disconnected';
                    statusElement.innerHTML = '<i class="fas fa-circle"></i><span>Disconnected</span>';
                }
            }
            
            if (connectBtn) {
                if (connected) {
                    connectBtn.innerHTML = '<i class="fas fa-unlink me-2"></i>Disconnect';
                    connectBtn.className = 'btn btn-secondary';
                } else {
                    connectBtn.innerHTML = '<i class="fas fa-plug me-2"></i>Connect';
                    connectBtn.className = 'btn btn-primary';
                }
            }
        }
        
        function handleMockResponse(message) {
            if (!websocket || !websocket.message) return;
            
            switch (message.type) {
                case 'chat_message':
                    // Echo the message back
                    websocket.message({
                        data: JSON.stringify({
                            type: 'chat_message',
                            id: 'msg_' + Date.now(),
                            message: message.message,
                            user_id: 'demo_user',
                            user_name: currentUserName,
                            user_role: currentUserRole,
                            timestamp: Date.now(),
                            room_id: message.room_id
                        })
                    });
                    break;
            }
        }
        
        // Test functions
        function testSound(type) {
            if (notificationInterface) {
                notificationInterface.playSound(type);
            }
        }
        
        function testNotification(type) {
            if (notificationInterface) {
                notificationInterface.testNotification(type);
            }
        }
        
        function simulateMessage(customMessage = null) {
            if (!websocket || !websocket.message) return;
            
            const message = customMessage || mockMessages[Math.floor(Math.random() * mockMessages.length)];
            
            websocket.message({
                data: JSON.stringify({
                    type: 'chat_message',
                    id: 'sim_' + Date.now(),
                    message: message,
                    user_id: 'sim_user_' + Math.random().toString(36).substr(2, 5),
                    user_name: mockUserNames[Math.floor(Math.random() * mockUserNames.length)],
                    user_role: 'participant',
                    timestamp: Date.now(),
                    room_id: currentRoomId
                })
            });
        }
        
        function simulateUserJoin() {
            if (!websocket || !websocket.message) return;
            
            const userName = mockUserNames[Math.floor(Math.random() * mockUserNames.length)];
            
            websocket.message({
                data: JSON.stringify({
                    type: 'user_joined',
                    user: {
                        id: 'user_' + Date.now(),
                        name: userName,
                        user_name: userName,
                        role: 'participant',
                        user_role: 'participant'
                    }
                })
            });
        }
        
        function simulateUserLeave() {
            if (!websocket || !websocket.message) return;
            
            const userName = mockUserNames[Math.floor(Math.random() * mockUserNames.length)];
            
            websocket.message({
                data: JSON.stringify({
                    type: 'user_left',
                    user: {
                        id: 'user_' + Date.now(),
                        name: userName,
                        user_name: userName,
                        role: 'participant',
                        user_role: 'participant'
                    }
                })
            });
        }
        
        function simulateMentionMessage() {
            if (!websocket || !websocket.message) return;
            
            const mentionMessages = [
                `@${currentUserName} what do you think about this approach?`,
                `Hey @${currentUserName}, could you help with this?`,
                `@${currentUserName} great point! I agree completely.`,
                `Thanks @${currentUserName} for the clarification.`
            ];
            
            const message = mentionMessages[Math.floor(Math.random() * mentionMessages.length)];
            
            websocket.message({
                data: JSON.stringify({
                    type: 'chat_message',
                    id: 'mention_' + Date.now(),
                    message: message,
                    user_id: 'mention_user_' + Math.random().toString(36).substr(2, 5),
                    user_name: mockUserNames[Math.floor(Math.random() * mockUserNames.length)],
                    user_role: 'participant',
                    timestamp: Date.now(),
                    room_id: currentRoomId
                })
            });
        }
        
        function simulatePrivateMessage() {
            if (!websocket || !websocket.message) return;
            
            const privateMessages = [
                "Hey, can we discuss this privately?",
                "I have a question about the project.",
                "Thanks for your help earlier!",
                "Could you review my code when you have time?"
            ];
            
            const message = privateMessages[Math.floor(Math.random() * privateMessages.length)];
            
            websocket.message({
                data: JSON.stringify({
                    type: 'private_message',
                    id: 'private_' + Date.now(),
                    message: message,
                    user_id: 'private_user_' + Math.random().toString(36).substr(2, 5),
                    user_name: mockUserNames[Math.floor(Math.random() * mockUserNames.length)],
                    user_role: 'participant',
                    timestamp: Date.now(),
                    room_id: currentRoomId
                })
            });
        }
        
        function clearAllNotifications() {
            if (notificationInterface) {
                notificationInterface.clearAllNotifications();
            }
        }
        
        // Auto-connect on page load
        setTimeout(() => {
            connectWebSocket();
        }, 1000);
    </script>
</body>
</html>
