<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Indicators - Interviews.tv</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom Dark Theme CSS -->
    <style>
        :root {
            --primary-color: #FF0000;
            --bg-dark: #1a1a1a;
            --card-dark: #2a2a2a;
            --input-dark: #3a3a3a;
            --text-light: #ffffff;
            --text-muted: #cccccc;
            --border-color: #444444;
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-light);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
        }

        .navbar {
            background-color: var(--card-dark) !important;
            border-bottom: 2px solid var(--primary-color);
            flex-shrink: 0;
        }

        .navbar-brand {
            color: var(--primary-color) !important;
            font-weight: bold;
            font-size: 1.5rem;
        }

        .navbar-nav .nav-link {
            color: var(--text-light) !important;
        }

        .navbar-nav .nav-link:hover {
            color: var(--primary-color) !important;
        }

        .main-container {
            display: flex;
            height: calc(100vh - 76px);
        }

        .demo-sidebar {
            width: 350px;
            background: var(--card-dark);
            border-right: 1px solid var(--border-color);
            padding: 1.5rem;
            overflow-y: auto;
            flex-shrink: 0;
        }

        .demo-section {
            margin-bottom: 2rem;
        }

        .demo-section h5 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .demo-controls {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .status-indicator.connected {
            background-color: rgba(40, 167, 69, 0.2);
            color: #28a745;
            border: 1px solid #28a745;
        }

        .status-indicator.disconnected {
            background-color: rgba(220, 53, 69, 0.2);
            color: #dc3545;
            border: 1px solid #dc3545;
        }

        .demo-control {
            background: var(--input-dark);
            border: 1px solid var(--border-color);
            color: var(--text-light);
            border-radius: 6px;
            padding: 0.5rem 0.75rem;
            font-size: 0.9rem;
        }

        .demo-control:focus {
            outline: none;
            border-color: var(--primary-color);
            color: var(--text-light);
        }

        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .btn-primary:hover {
            background-color: #cc0000;
            border-color: #cc0000;
        }

        .btn-secondary {
            background-color: var(--input-dark);
            border-color: var(--border-color);
            color: var(--text-light);
        }

        .btn-secondary:hover {
            background-color: #4a4a4a;
            border-color: #555;
            color: var(--text-light);
        }

        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
            position: relative;
        }

        .demo-info {
            background: rgba(23, 162, 184, 0.1);
            border: 1px solid #17a2b8;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .demo-info h6 {
            color: #17a2b8;
            margin-bottom: 0.5rem;
        }

        .demo-info p {
            color: var(--text-muted);
            margin-bottom: 0;
            font-size: 0.9rem;
        }

        .feature-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .feature-list li {
            padding: 0.25rem 0;
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .feature-list li i {
            color: var(--primary-color);
            width: 16px;
            margin-right: 0.5rem;
        }

        .typing-settings {
            background: var(--input-dark);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .typing-settings h6 {
            color: var(--text-light);
            margin-bottom: 0.75rem;
        }

        .typing-setting-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
            font-size: 0.9rem;
        }

        .typing-setting-item:last-child {
            margin-bottom: 0;
        }

        .typing-setting-label {
            color: var(--text-muted);
        }

        .typing-setting-control {
            background: var(--card-dark);
            border: 1px solid var(--border-color);
            color: var(--text-light);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            min-width: 60px;
        }

        .typing-stats {
            background: var(--input-dark);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .typing-stats h6 {
            color: var(--text-light);
            margin-bottom: 0.75rem;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.25rem 0;
            font-size: 0.9rem;
        }

        .stat-label {
            color: var(--text-muted);
        }

        .stat-value {
            color: var(--primary-color);
            font-weight: 600;
        }

        .simulation-controls {
            background: var(--input-dark);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .simulation-controls h6 {
            color: var(--text-light);
            margin-bottom: 0.75rem;
        }

        .simulation-btn {
            background: var(--card-dark);
            border: 1px solid var(--border-color);
            color: var(--text-light);
            padding: 0.4rem 0.8rem;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
            margin: 0.25rem;
        }

        .simulation-btn:hover {
            background: var(--primary-color);
            border-color: var(--primary-color);
        }

        .typing-demo-controls {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid var(--primary-color);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .typing-demo-controls h6 {
            color: var(--primary-color);
            margin-bottom: 0.75rem;
        }

        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }
            
            .demo-sidebar {
                width: 100%;
                height: auto;
                max-height: 300px;
                padding: 1rem;
            }
            
            .demo-controls {
                flex-direction: row;
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-video me-2"></i>Interviews.tv
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="interview-room.html">
                            <i class="fas fa-comments me-1"></i>Basic Chat
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="chat-moderation-demo.html">
                            <i class="fas fa-shield-alt me-1"></i>Moderation
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="private-messaging-demo.html">
                            <i class="fas fa-envelope me-1"></i>Private Messages
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="chat-export-demo.html">
                            <i class="fas fa-download me-1"></i>Export
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="modern-chat-demo.html">
                            <i class="fas fa-sparkles me-1"></i>Modern Chat
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="message-threading-demo.html">
                            <i class="fas fa-comments me-1"></i>Threading
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="typing-indicators-demo.html">
                            <i class="fas fa-keyboard me-1"></i>Typing
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="main-container">
        <!-- Demo Sidebar -->
        <div class="demo-sidebar">
            <!-- Connection Status -->
            <div class="demo-section">
                <h5><i class="fas fa-wifi me-2"></i>Connection</h5>
                <div class="demo-controls">
                    <div class="status-indicator disconnected" id="connection-status">
                        <i class="fas fa-circle"></i>
                        <span>Disconnected</span>
                    </div>
                    <button class="btn btn-primary" id="connect-btn">
                        <i class="fas fa-plug me-2"></i>Connect
                    </button>
                </div>
            </div>

            <!-- User Settings -->
            <div class="demo-section">
                <h5><i class="fas fa-user me-2"></i>User Settings</h5>
                <div class="demo-controls">
                    <select class="demo-control" id="user-role">
                        <option value="participant">Participant</option>
                        <option value="host">Host</option>
                        <option value="moderator">Moderator</option>
                        <option value="admin" selected>Admin</option>
                    </select>
                    <input type="text" class="demo-control" id="user-name" placeholder="Your name" value="Demo User">
                    <input type="text" class="demo-control" id="room-id" placeholder="Room ID" value="demo_room">
                </div>
            </div>

            <!-- Typing Features -->
            <div class="demo-section">
                <h5><i class="fas fa-keyboard me-2"></i>Typing Features</h5>
                <ul class="feature-list">
                    <li><i class="fas fa-check"></i>Real-time typing detection</li>
                    <li><i class="fas fa-check"></i>Animated typing indicators</li>
                    <li><i class="fas fa-check"></i>Multiple user typing support</li>
                    <li><i class="fas fa-check"></i>User list typing indicators</li>
                    <li><i class="fas fa-check"></i>Chat header typing status</li>
                    <li><i class="fas fa-check"></i>Typing timeout management</li>
                    <li><i class="fas fa-check"></i>Throttled typing notifications</li>
                    <li><i class="fas fa-check"></i>Customizable typing settings</li>
                    <li><i class="fas fa-check"></i>Typing sound effects</li>
                    <li><i class="fas fa-check"></i>Mobile-responsive design</li>
                </ul>
            </div>

            <!-- Typing Settings -->
            <div class="typing-settings">
                <h6><i class="fas fa-cog me-2"></i>Typing Settings</h6>
                <div class="typing-setting-item">
                    <span class="typing-setting-label">Timeout (ms):</span>
                    <input type="number" class="typing-setting-control" id="typing-timeout" value="3000" min="1000" max="10000" step="500">
                </div>
                <div class="typing-setting-item">
                    <span class="typing-setting-label">Throttle (ms):</span>
                    <input type="number" class="typing-setting-control" id="typing-throttle" value="1000" min="500" max="5000" step="250">
                </div>
                <div class="typing-setting-item">
                    <span class="typing-setting-label">Max Users:</span>
                    <input type="number" class="typing-setting-control" id="max-typing-users" value="5" min="1" max="10">
                </div>
                <div class="typing-setting-item">
                    <span class="typing-setting-label">Show in User List:</span>
                    <input type="checkbox" class="typing-setting-control" id="show-in-user-list" checked>
                </div>
                <div class="typing-setting-item">
                    <span class="typing-setting-label">Animate Dots:</span>
                    <input type="checkbox" class="typing-setting-control" id="animate-dots" checked>
                </div>
                <div class="typing-setting-item">
                    <span class="typing-setting-label">Typing Sound:</span>
                    <input type="checkbox" class="typing-setting-control" id="typing-sound">
                </div>
            </div>

            <!-- Typing Statistics -->
            <div class="typing-stats">
                <h6><i class="fas fa-chart-bar me-2"></i>Typing Statistics</h6>
                <div class="stat-item">
                    <span class="stat-label">Currently Typing:</span>
                    <span class="stat-value" id="current-typing">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Typing Users:</span>
                    <span class="stat-value" id="typing-users">None</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Longest Duration:</span>
                    <span class="stat-value" id="longest-duration">0s</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Average Duration:</span>
                    <span class="stat-value" id="average-duration">0s</span>
                </div>
            </div>

            <!-- Typing Demo Controls -->
            <div class="typing-demo-controls">
                <h6><i class="fas fa-robot me-2"></i>Typing Simulation</h6>
                <button class="simulation-btn" onclick="simulateUserTyping()">
                    <i class="fas fa-keyboard me-1"></i>Start Typing
                </button>
                <button class="simulation-btn" onclick="simulateMultipleTyping()">
                    <i class="fas fa-users me-1"></i>Multiple Users
                </button>
                <button class="simulation-btn" onclick="simulateTypingStop()">
                    <i class="fas fa-stop me-1"></i>Stop Typing
                </button>
                <button class="simulation-btn" onclick="updateTypingStats()">
                    <i class="fas fa-sync me-1"></i>Update Stats
                </button>
            </div>

            <!-- General Simulation Controls -->
            <div class="simulation-controls">
                <h6><i class="fas fa-robot me-2"></i>General Simulation</h6>
                <button class="simulation-btn" onclick="simulateMessage()">
                    <i class="fas fa-comment me-1"></i>Message
                </button>
                <button class="simulation-btn" onclick="simulateUser()">
                    <i class="fas fa-user-plus me-1"></i>User Join
                </button>
                <button class="simulation-btn" onclick="clearAllTyping()">
                    <i class="fas fa-trash me-1"></i>Clear All
                </button>
            </div>
        </div>

        <!-- Chat Container -->
        <div class="chat-container">
            <!-- Demo Info -->
            <div class="demo-info">
                <h6><i class="fas fa-info-circle me-2"></i>Typing Indicators</h6>
                <p>Experience real-time typing awareness with animated indicators, user list integration, and comprehensive typing management. Start typing in the chat input to see your own typing indicator, or use the simulation controls to see how multiple users typing appears.</p>
            </div>

            <!-- Chat Interface -->
            <div id="modern-chat-container" style="flex: 1;"></div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Chat Components -->
    <script src="../src/components/EmojiInterface.js"></script>
    <script src="../src/components/ChatModerationInterface.js"></script>
    <script src="../src/components/ChatCommandInterface.js"></script>
    <script src="../src/components/PrivateMessageInterface.js"></script>
    <script src="../src/components/ChatExportInterface.js"></script>
    <script src="../src/components/MessageThreadingInterface.js"></script>
    <script src="../src/components/TypingIndicatorInterface.js"></script>
    <script src="../src/components/ModernChatInterface.js"></script>
    
    <!-- Demo Script -->
    <script>
        let websocket = null;
        let modernChatInterface = null;
        let typingInterface = null;
        let currentUserRole = 'admin';
        let currentUserName = 'Demo User';
        let currentRoomId = 'demo_room';
        
        // Mock data for simulation
        const mockUsers = [
            { id: 'user1', name: 'Alice Johnson', role: 'host' },
            { id: 'user2', name: 'Bob Smith', role: 'participant' },
            { id: 'user3', name: 'Carol Davis', role: 'moderator' },
            { id: 'user4', name: 'David Wilson', role: 'participant' },
            { id: 'user5', name: 'Emma Brown', role: 'participant' },
            { id: 'user6', name: 'Frank Miller', role: 'participant' }
        ];
        
        const mockMessages = [
            "Welcome to the interview! Let's start with introductions.",
            "Hi everyone! I'm excited to be here today.",
            "Could you tell us about your background in software development?",
            "I have 5 years of experience working with JavaScript and React.",
            "That's impressive! What's your favorite project you've worked on?",
            "I built a real-time chat application with WebSocket support.",
            "Interesting! How did you handle scalability challenges?",
            "We used Redis for message queuing and horizontal scaling."
        ];
        
        // Initialize demo
        document.addEventListener('DOMContentLoaded', function() {
            initializeDemo();
            attachEventListeners();
        });
        
        function initializeDemo() {
            // Initialize modern chat interface with typing
            const container = document.getElementById('modern-chat-container');
            
            if (typeof ModernChatInterface !== 'undefined') {
                modernChatInterface = new ModernChatInterface({
                    container: container,
                    websocket: websocket,
                    currentUserId: 'demo_user',
                    currentUserRole: currentUserRole,
                    roomId: currentRoomId,
                    settings: {
                        theme: 'dark',
                        fontSize: 'medium',
                        soundEnabled: true,
                        notificationsEnabled: true,
                        showTimestamps: true,
                        showAvatars: true,
                        compactMode: false,
                        autoScroll: true
                    }
                });
                
                // Set global reference for onclick handlers
                window.modernChat = modernChatInterface;
                
                // Get typing interface reference
                typingInterface = modernChatInterface.typingInterface;
                window.typingIndicator = typingInterface;
            }
        }
        
        function attachEventListeners() {
            // Connect button
            document.getElementById('connect-btn')?.addEventListener('click', toggleConnection);
            
            // User settings
            document.getElementById('user-role')?.addEventListener('change', (e) => {
                currentUserRole = e.target.value;
                if (modernChatInterface) {
                    modernChatInterface.setUserInfo('demo_user', currentUserRole);
                }
            });
            
            document.getElementById('user-name')?.addEventListener('change', (e) => {
                currentUserName = e.target.value;
            });
            
            document.getElementById('room-id')?.addEventListener('change', (e) => {
                currentRoomId = e.target.value;
                if (modernChatInterface) {
                    modernChatInterface.setRoomId(currentRoomId);
                }
            });
            
            // Typing settings
            attachTypingSettingsListeners();
        }
        
        function attachTypingSettingsListeners() {
            const typingTimeout = document.getElementById('typing-timeout');
            const typingThrottle = document.getElementById('typing-throttle');
            const maxTypingUsers = document.getElementById('max-typing-users');
            const showInUserList = document.getElementById('show-in-user-list');
            const animateDots = document.getElementById('animate-dots');
            const typingSound = document.getElementById('typing-sound');
            
            typingTimeout?.addEventListener('change', (e) => {
                if (typingInterface) {
                    typingInterface.updateTypingSetting('typingTimeout', parseInt(e.target.value));
                }
            });
            
            typingThrottle?.addEventListener('change', (e) => {
                if (typingInterface) {
                    typingInterface.updateTypingSetting('typingThrottle', parseInt(e.target.value));
                }
            });
            
            maxTypingUsers?.addEventListener('change', (e) => {
                if (typingInterface) {
                    typingInterface.updateTypingSetting('maxTypingUsers', parseInt(e.target.value));
                }
            });
            
            showInUserList?.addEventListener('change', (e) => {
                if (typingInterface) {
                    typingInterface.updateTypingSetting('showTypingInUserList', e.target.checked);
                }
            });
            
            animateDots?.addEventListener('change', (e) => {
                if (typingInterface) {
                    typingInterface.updateTypingSetting('animateTypingDots', e.target.checked);
                }
            });
            
            typingSound?.addEventListener('change', (e) => {
                if (typingInterface) {
                    typingInterface.updateTypingSetting('typingSound', e.target.checked);
                }
            });
        }
        
        function toggleConnection() {
            if (websocket && websocket.readyState === WebSocket.OPEN) {
                disconnectWebSocket();
            } else {
                connectWebSocket();
            }
        }
        
        function connectWebSocket() {
            try {
                // Simulate WebSocket connection
                websocket = {
                    readyState: WebSocket.OPEN,
                    send: function(data) {
                        console.log('Sending:', JSON.parse(data));
                        // Simulate server responses
                        setTimeout(() => {
                            const message = JSON.parse(data);
                            handleMockResponse(message);
                        }, 100);
                    },
                    addEventListener: function(event, handler) {
                        this[event] = handler;
                    },
                    close: function() {
                        this.readyState = WebSocket.CLOSED;
                        if (this.onclose) this.onclose();
                    }
                };
                
                console.log('Mock WebSocket connected');
                updateConnectionStatus(true);
                
                // Update chat interface
                if (modernChatInterface) {
                    modernChatInterface.setWebSocket(websocket);
                }
                
                // Simulate initial user list
                setTimeout(() => {
                    if (websocket.message) {
                        websocket.message({
                            data: JSON.stringify({
                                type: 'user_list',
                                users: mockUsers
                            })
                        });
                    }
                }, 500);
                
                // Add some initial messages
                setTimeout(() => {
                    mockMessages.slice(0, 4).forEach((msg, index) => {
                        setTimeout(() => {
                            simulateMessage(msg, mockUsers[index % mockUsers.length]);
                        }, index * 1000);
                    });
                }, 1000);
                
            } catch (error) {
                console.error('Failed to connect WebSocket:', error);
                updateConnectionStatus(false);
            }
        }
        
        function disconnectWebSocket() {
            if (websocket) {
                websocket.close();
                websocket = null;
            }
            updateConnectionStatus(false);
        }
        
        function updateConnectionStatus(connected) {
            const statusElement = document.getElementById('connection-status');
            const connectBtn = document.getElementById('connect-btn');
            
            if (statusElement) {
                if (connected) {
                    statusElement.className = 'status-indicator connected';
                    statusElement.innerHTML = '<i class="fas fa-circle"></i><span>Connected</span>';
                } else {
                    statusElement.className = 'status-indicator disconnected';
                    statusElement.innerHTML = '<i class="fas fa-circle"></i><span>Disconnected</span>';
                }
            }
            
            if (connectBtn) {
                if (connected) {
                    connectBtn.innerHTML = '<i class="fas fa-unlink me-2"></i>Disconnect';
                    connectBtn.className = 'btn btn-secondary';
                } else {
                    connectBtn.innerHTML = '<i class="fas fa-plug me-2"></i>Connect';
                    connectBtn.className = 'btn btn-primary';
                }
            }
        }
        
        function handleMockResponse(message) {
            if (!websocket || !websocket.message) return;
            
            switch (message.type) {
                case 'chat_message':
                    // Echo the message back
                    websocket.message({
                        data: JSON.stringify({
                            type: 'chat_message',
                            id: 'msg_' + Date.now(),
                            message: message.message,
                            user_id: 'demo_user',
                            user_name: currentUserName,
                            user_role: currentUserRole,
                            timestamp: Date.now(),
                            room_id: message.room_id,
                            reply_to: message.reply_to
                        })
                    });
                    break;
                    
                case 'typing_start':
                    // Simulate typing response from other users
                    setTimeout(() => {
                        const randomUser = mockUsers[Math.floor(Math.random() * mockUsers.length)];
                        if (websocket.message) {
                            websocket.message({
                                data: JSON.stringify({
                                    type: 'typing_start',
                                    user_id: randomUser.id,
                                    user_name: randomUser.name,
                                    user_role: randomUser.role
                                })
                            });
                        }
                    }, 1000);
                    break;
                    
                case 'get_chat_history':
                    // Send some mock history
                    setTimeout(() => {
                        if (websocket.message) {
                            mockMessages.slice(0, 3).forEach((msg, index) => {
                                websocket.message({
                                    data: JSON.stringify({
                                        type: 'chat_message',
                                        id: 'history_' + index,
                                        message: msg,
                                        user_id: mockUsers[index % mockUsers.length].id,
                                        user_name: mockUsers[index % mockUsers.length].name,
                                        user_role: mockUsers[index % mockUsers.length].role,
                                        timestamp: Date.now() - (300000 * (3 - index)),
                                        room_id: message.room_id
                                    })
                                });
                            });
                        }
                    }, 200);
                    break;
            }
        }
        
        // Simulation functions
        function simulateMessage(customMessage = null, customUser = null) {
            if (!websocket || !websocket.message) return;
            
            const user = customUser || mockUsers[Math.floor(Math.random() * mockUsers.length)];
            const message = customMessage || mockMessages[Math.floor(Math.random() * mockMessages.length)];
            
            websocket.message({
                data: JSON.stringify({
                    type: 'chat_message',
                    id: 'sim_' + Date.now(),
                    message: message,
                    user_id: user.id,
                    user_name: user.name,
                    user_role: user.role,
                    timestamp: Date.now(),
                    room_id: currentRoomId
                })
            });
        }
        
        function simulateUser() {
            if (!websocket || !websocket.message) return;
            
            const newUser = {
                id: 'user_' + Date.now(),
                name: 'New User ' + Math.floor(Math.random() * 100),
                role: 'participant'
            };
            
            websocket.message({
                data: JSON.stringify({
                    type: 'user_joined',
                    user: newUser
                })
            });
        }
        
        // Typing simulation functions
        function simulateUserTyping() {
            if (!websocket || !websocket.message) return;
            
            const randomUser = mockUsers[Math.floor(Math.random() * mockUsers.length)];
            
            websocket.message({
                data: JSON.stringify({
                    type: 'typing_start',
                    user_id: randomUser.id,
                    user_name: randomUser.name,
                    user_role: randomUser.role
                })
            });
            
            // Auto-stop after random time
            setTimeout(() => {
                if (websocket && websocket.message) {
                    websocket.message({
                        data: JSON.stringify({
                            type: 'typing_stop',
                            user_id: randomUser.id
                        })
                    });
                }
            }, Math.random() * 5000 + 2000);
        }
        
        function simulateMultipleTyping() {
            // Simulate 2-4 users typing at once
            const numUsers = Math.floor(Math.random() * 3) + 2;
            const selectedUsers = mockUsers.slice(0, numUsers);
            
            selectedUsers.forEach((user, index) => {
                setTimeout(() => {
                    if (websocket && websocket.message) {
                        websocket.message({
                            data: JSON.stringify({
                                type: 'typing_start',
                                user_id: user.id,
                                user_name: user.name,
                                user_role: user.role
                            })
                        });
                    }
                }, index * 500);
                
                // Auto-stop after random time
                setTimeout(() => {
                    if (websocket && websocket.message) {
                        websocket.message({
                            data: JSON.stringify({
                                type: 'typing_stop',
                                user_id: user.id
                            })
                        });
                    }
                }, Math.random() * 4000 + 3000 + (index * 500));
            });
        }
        
        function simulateTypingStop() {
            if (!typingInterface) return;
            
            // Stop all current typing
            typingInterface.clearAllTyping();
        }
        
        function clearAllTyping() {
            if (!typingInterface) return;
            
            typingInterface.clearAllTyping();
            updateTypingStats();
        }
        
        function updateTypingStats() {
            if (!typingInterface) return;
            
            const stats = typingInterface.getTypingStatistics();
            
            document.getElementById('current-typing').textContent = stats.totalTypingUsers;
            document.getElementById('typing-users').textContent = 
                stats.typingUserNames.length > 0 ? stats.typingUserNames.join(', ') : 'None';
            document.getElementById('longest-duration').textContent = 
                Math.round(stats.longestTypingDuration / 1000) + 's';
            document.getElementById('average-duration').textContent = 
                Math.round(stats.averageTypingDuration / 1000) + 's';
        }
        
        // Auto-connect on page load
        setTimeout(() => {
            connectWebSocket();
        }, 1000);
        
        // Update stats periodically
        setInterval(() => {
            if (typingInterface) {
                updateTypingStats();
            }
        }, 2000);
    </script>
</body>
</html>
